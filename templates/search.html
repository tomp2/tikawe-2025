{% extends "layout.html" %}
{% block title %}Search Doodles - Doodle App{% endblock %}
{% block content %}
  <div class="container">
    <h2>Search Doodles</h2>

    <form action="{{ url_for('search.page') }}" method="GET">
      <label for="query">Search:</label>
      <input type="text" id="query" name="q" placeholder="Search by title or description..." value="{{ query }}"
             required>
      <button type="submit">Search</button>
    </form>
    {% if query %}
      <h3>Results for "{{ query }}"</h3>
      {% if doodles %}
        <div class="doodles">
          {% if doodles == [] %}
            <p>No doodles found.</p>
          {% else %}
            {% for doodle in doodles %}
              <div class="small-post">
                <a href="/doodle/{{ doodle.id }}">
                  <img src="/image/{{ doodle.image_url }}" alt="Doodle Image">
                </a>
                {% if doodle.reactions %}
                  <div class="reactions">
                    {% for emoji, count in doodle.reactions.items() %}
                      <div>{{ emoji }}x{{ count }}</div>
                    {% endfor %}
                  </div>
                {% endif %}
                <a href="/doodle/{{ doodle.id }}"><h3>{{ doodle.title }}</h3></a>
                <p>{{ doodle.description }}</p>
                <div class="tags">
                  {% for tag in doodle.tags.split(',') %}
                    <a href="{{ url_for('search.page', q='#'+tag) }}" class="tag-badge">#{{ tag }}</a>
                  {% endfor %}
                </div>
                <p><strong>Likes:</strong> {{ doodle.likes }}</p>
                <p><strong>Views:</strong> {{ doodle.views }}</p>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      {% else %}
        <p>No doodles found for "{{ query }}".</p>
      {% endif %}
    {% endif %}
  </div>
{% endblock %}
